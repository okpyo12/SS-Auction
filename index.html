<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
    <script src='web3.min.js'></script>
    <script src="//code.jquery.com/jquery-3.3.1.min.js"></script>
    <script type="text/javascript">

        async function registClick() {

            if (contractInstance != null) {
                try {
                    let valproductName = document.getElementsByClassName('productName')[0].value
                    let valproductAmount = document.getElementsByClassName('productAmount')[0].value
                    let valproductTime = document.getElementsByClassName('productTime')[0].value
                    let value = await contractInstance.methods.registerProduct(valproductName, valproductAmount, valproductTime).send({ from: accounts[0] });

                    // auction product list 에 동적 추가
                    $('.ProductWrap > div:last-child').append(
                        "<div class=\"product\" onclick=\"bidding()\">\n" +
                            "<span>"+valproductName+"</span>\n" +
                            "<span>\n" +
                                "<span>min bidding :</span>\n" +
                                "<span>"+valproductAmount+" eth</span>\n" +
                            "</span>\n" +
                        "</div>"
                    );

                } catch (e) {
                    console.log(e)
                }
            }
        }

        async function bidClick() {
            if (contractInstance != null) {
                try {
                    let valbidAmount = document.getElementsByClassName('bidAmount')[0].value
                    let value = await contractInstance.methods.registerProduct(valbidAmount).send({ from: accounts[0] });
                } catch (e) {
                    console.log(e)
                }
            }
        }

        // show bidding block
        function bidding(number) {
            let hiddenBlock = document.getElementById('main')
            let showBlock = document.getElementById('bidding')
            hiddenBlock.style.display = 'none';
            showBlock.style.display = 'block';
        }

        // back to main block
        function backToMain() {
            let hiddenBlock = document.getElementById('bidding')
            let showBlock = document.getElementById('main')
            hiddenBlock.style.display = 'none';
            showBlock.style.display = 'block';
        }

        // wallet 연결
        async function connectWallet() {
            var web3 = new Web3(Web3.givenProvider);
            web3.eth.getAccounts(function (error, account) {
                if (error) {
                    console.log(error);
                    return;
                }
                accounts = account
                const showAccount = document.querySelector('.address')
                showAccount.innerHTML = account[0]
            });

            var abiobj = [
                {
                    "anonymous": false,
                    "inputs": [
                        {
                            "indexed": false,
                            "internalType": "uint256",
                            "name": "productId",
                            "type": "uint256"
                        },
                        {
                            "indexed": false,
                            "internalType": "address",
                            "name": "winner",
                            "type": "address"
                        },
                        {
                            "indexed": false,
                            "internalType": "uint256",
                            "name": "bid",
                            "type": "uint256"
                        }
                    ],
                    "name": "AuctionEnded",
                    "type": "event"
                },
                {
                    "inputs": [
                        {
                            "internalType": "uint256",
                            "name": "_productId",
                            "type": "uint256"
                        }
                    ],
                    "name": "bid",
                    "outputs": [],
                    "stateMutability": "payable",
                    "type": "function"
                },
                {
                    "inputs": [
                        {
                            "internalType": "uint256",
                            "name": "_productId",
                            "type": "uint256"
                        }
                    ],
                    "name": "endAuction",
                    "outputs": [],
                    "stateMutability": "nonpayable",
                    "type": "function"
                },
                {
                    "anonymous": false,
                    "inputs": [
                        {
                            "indexed": false,
                            "internalType": "uint256",
                            "name": "productId",
                            "type": "uint256"
                        }
                    ],
                    "name": "NewProduct",
                    "type": "event"
                },
                {
                    "inputs": [
                        {
                            "internalType": "string",
                            "name": "_name",
                            "type": "string"
                        },
                        {
                            "internalType": "uint256",
                            "name": "_price",
                            "type": "uint256"
                        },
                        {
                            "internalType": "uint256",
                            "name": "_auctionEnd",
                            "type": "uint256"
                        }
                    ],
                    "name": "registerProduct",
                    "outputs": [],
                    "stateMutability": "nonpayable",
                    "type": "function"
                },
                {
                    "inputs": [
                        {
                            "internalType": "uint256",
                            "name": "",
                            "type": "uint256"
                        }
                    ],
                    "name": "auctionInfo",
                    "outputs": [
                        {
                            "internalType": "address payable",
                            "name": "beneficiary",
                            "type": "address"
                        },
                        {
                            "internalType": "uint256",
                            "name": "auctionEnd",
                            "type": "uint256"
                        },
                        {
                            "internalType": "bool",
                            "name": "ended",
                            "type": "bool"
                        }
                    ],
                    "stateMutability": "view",
                    "type": "function"
                },
                {
                    "inputs": [],
                    "name": "getAuctions",
                    "outputs": [
                        {
                            "components": [
                                {
                                    "internalType": "address payable",
                                    "name": "beneficiary",
                                    "type": "address"
                                },
                                {
                                    "internalType": "uint256",
                                    "name": "auctionEnd",
                                    "type": "uint256"
                                },
                                {
                                    "internalType": "bool",
                                    "name": "ended",
                                    "type": "bool"
                                }
                            ],
                            "internalType": "struct Auction.AuctionInfo[]",
                            "name": "",
                            "type": "tuple[]"
                        }
                    ],
                    "stateMutability": "view",
                    "type": "function"
                },
                {
                    "inputs": [
                        {
                            "internalType": "uint256",
                            "name": "_productId",
                            "type": "uint256"
                        }
                    ],
                    "name": "getProduct",
                    "outputs": [
                        {
                            "internalType": "string",
                            "name": "",
                            "type": "string"
                        },
                        {
                            "internalType": "uint256",
                            "name": "",
                            "type": "uint256"
                        },
                        {
                            "internalType": "address",
                            "name": "",
                            "type": "address"
                        },
                        {
                            "internalType": "bool",
                            "name": "",
                            "type": "bool"
                        },
                        {
                            "internalType": "address",
                            "name": "",
                            "type": "address"
                        },
                        {
                            "internalType": "uint256",
                            "name": "",
                            "type": "uint256"
                        }
                    ],
                    "stateMutability": "view",
                    "type": "function"
                },
                {
                    "inputs": [],
                    "name": "getProducts",
                    "outputs": [
                        {
                            "components": [
                                {
                                    "internalType": "string",
                                    "name": "name",
                                    "type": "string"
                                },
                                {
                                    "internalType": "uint256",
                                    "name": "price",
                                    "type": "uint256"
                                },
                                {
                                    "internalType": "address",
                                    "name": "owner",
                                    "type": "address"
                                },
                                {
                                    "internalType": "bool",
                                    "name": "sold",
                                    "type": "bool"
                                },
                                {
                                    "internalType": "address payable",
                                    "name": "bidder",
                                    "type": "address"
                                },
                                {
                                    "internalType": "uint256",
                                    "name": "bid",
                                    "type": "uint256"
                                }
                            ],
                            "internalType": "struct Auction.Product[]",
                            "name": "",
                            "type": "tuple[]"
                        }
                    ],
                    "stateMutability": "view",
                    "type": "function"
                },
                {
                    "inputs": [
                        {
                            "internalType": "uint256",
                            "name": "",
                            "type": "uint256"
                        }
                    ],
                    "name": "products",
                    "outputs": [
                        {
                            "internalType": "string",
                            "name": "name",
                            "type": "string"
                        },
                        {
                            "internalType": "uint256",
                            "name": "price",
                            "type": "uint256"
                        },
                        {
                            "internalType": "address",
                            "name": "owner",
                            "type": "address"
                        },
                        {
                            "internalType": "bool",
                            "name": "sold",
                            "type": "bool"
                        },
                        {
                            "internalType": "address payable",
                            "name": "bidder",
                            "type": "address"
                        },
                        {
                            "internalType": "uint256",
                            "name": "bid",
                            "type": "uint256"
                        }
                    ],
                    "stateMutability": "view",
                    "type": "function"
                }
            ];
            var address = "0x46E0F49191E82146135638b3ECE00eDE03317047";
            window.web3 = new Web3(window.ethereum);
            contractInstance = await new window.web3.eth.Contract(abiobj, address);
        }
    </script>
    <style>
        @font-face {
            font-family: 'BookkMyungjo-Bd';
            src: url('https://cdn.jsdelivr.net/gh/projectnoonnu/noonfonts_2302@1.0/BookkMyungjo-Bd.woff2') format('woff2');
            font-weight: 700;
            font-style: normal;
        }

        * {
            font-family: 'BookkMyungjo-Bd';
        }

        body > div {
            max-width: 1140px;
            margin: auto;
        }

        .infoWrap {
            margin: 60px 0 32px;
        }

        .infoWrap>div:nth-child(1) {
            font-size: 28px;
            font-weight: 700;
            margin-bottom: 12px;
        }

        .infoWrap>div:nth-child(2) {
            font-size: 22px;
            font-weight: 500;
            margin-bottom: 20px;
        }

        .infoWrap>div:nth-child(3) {
            margin-bottom: 40px;
            font-size: 18px;
        }

        .infoWrap>div:nth-child(4) {
            display: flex;
            align-items: center;
            font-size: 18px;
            gap: 12px;
        }

        .infoWrap>div:nth-child(4) button {
            all: unset;
            cursor: pointer;
            background-color: #D9D9D9;
            border-radius: 36px;
            padding: 12px 24px;
        }

        .infoWrap>div:nth-child(4) div {
            display: flex;
            align-items: center;
            margin: unset;
            font-size: 18px;
        }

        .blockWrap {
            margin-bottom: 60px;
        }

        .blockWrap>div {
            max-width: 500px;
            padding: 32px 40px 80px;
            width: 100%;
            margin: auto;
            border: 1px solid #000000;
            border-radius: 20px;
            position: relative;
        }

        .blockWrap > div > div {
            display: flex;
            flex-direction: column;
            margin-bottom: 20px;
        }

        .blockWrap button {
            all: unset;
            cursor: pointer;
            background-color: #D9D9D9;
            border-radius: 36px;
            padding: 8px 24px;
            position: absolute;
            bottom: 36px;
            left: 50%;
            transform: translateX(-50%);
        }

        .ProductWrap {
            margin-bottom: 60px;
        }

        .ProductWrap .product {
            border: 1px solid #7c7c7c;
            border-radius: 12px;
            padding: 20px 60px;
            cursor: pointer;
            display: flex;
            justify-content: space-between;
            margin-bottom: 12px;
        }

        .RecordWrap {
            margin-bottom: 60px;
        }

        .RecordWrap>div:first-child,
        .ProductWrap>div:first-child {
            font-weight: 700;
            font-size: 20px;
            margin-bottom: 20px;
        }

        #main .subTitle {
            font-weight: 700;
            font-size: 20px;
            text-align: center;
        }

        #bidding .subTitle {
            font-weight: 700;
            font-size: 20px;
            margin-bottom: 8px;
        }

        #bidding {
            display: none;
            max-width: 500px;
            width: 100%;
            padding: 32px 40px;
            border: 1px solid #000000;
            border-radius: 20px;
            margin: auto;
        }

        #bidding > div:first-child {
            cursor: pointer;
            margin-bottom: 32px;
        }

        #bidding input {
            max-width: 360px;
            width: 100%;
        }

        #bidding button {
            all: unset;
            cursor: pointer;
            background-color: #D9D9D9;
            border-radius: 36px;
            padding: 8px 24px;
            display: flex;
            margin: 20px auto;
        }

        .productInfo  {
            margin-bottom: 32px;
        }

        .inputTitle {
            font-weight: 600;
            font-size: 16px;
            color: #141414;
            margin-bottom: 8px;
        }

        input {
            border: 2px solid #E0E0E0;
            border-radius: 30px;
            flex: 100%;
            padding: 12px 20px;
        }

        input::-webkit-inner-spin-button {
            appearance: none;
            -moz-appearance: none;
            -webkit-appearance: none;
        }
    </style>
</head>

<body>
    <div>
        <div id="main">
            <div class="infoWrap">
                <div>
                    Project Name : $$-Auction
                </div>
                <div>
                    Team Name: Sangwoo Pyo(20181704), Sanglim Nam(20191584)
                </div>
                <div>
                    <a href="">Project 1 Demo Video</a>
                </div>
                <div>
                    <button onclick="connectWallet()">connect account</button>
                    <div>
                        <span>Address : </span>
                        <span class="address"></span>
                    </div>
                </div>
            </div>
            <div class="blockWrap">
                <div>
                    <div class="subTitle">Registering a Product</div>
                    <div>
                        <div class="inputTitle">Product Name</div>
                        <input class="productName" type="text" placeholder="Enter the product name" />
                    </div>
                    <div>
                        <div class="inputTitle">Minimum bid amount</div>
                        <input class="productAmount" type="number" placeholder="Enter the minimum bid amount" />
                    </div>
                    <div>
                        <div class="inputTitle">End time of auction</div>
                        <input class="productTime" type="number" placeholder="Enter the end time of auction" />
                    </div>
                    <button onclick="registClick()">Register</button>
                </div>
            </div>
            <div class="ProductWrap">
                <div>List of auction products</div>
                <div>
                    <div class="product" onclick="bidding()">
                        <span>product name</span>
                        <span>
                            <span>min bidding :</span>
                            <span>1 eth</span>
                        </span>
                    </div>
                    <div class="product" onclick="bidding()">
                        <span>product name</span>
                        <span>
                            <span>min bidding :</span>
                            <span>1 eth</span>
                        </span>
                    </div>
                </div>
            </div>
            <div class="RecordWrap">
                <div>Check all auction records</div>
                <div></div>
            </div>
        </div>
        <div id="bidding">
            <div onclick="backToMain()">↪ back</div>
            <div class="productInfo">
                <div class="subTitle">
                    <span>Product Name : </span>
                    <span></span>
                </div>
                <div class="subTitle">
                    <span>Minimum bidding amount : </span>
                    <span></span>
                </div>
                <div class="subTitle">
                    <span>Current bidding amount : </span>
                    <span></span>
                </div>
            </div>
            <div>
                <div>
                    <div class="inputTitle">Bid amount</div>
                    <input type="number" placeholder="Enter the bid amount" />
                </div>
                <button>Bidding</button>
            </div>
        </div>
    </div>
</body>
</html>